{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pathway Agent Input Context",
  "description": "Contextual data required by the Pathway Agent to decide the next best action.",
  "type": "object",
  "required": [
    "learnerId",
    "currentTimestamp",
    "masteryState",
    "engagementState"
  ],
  "properties": {
    "learnerId": {
      "type": "string",
      "description": "Unique identifier for the learner."
    },
    "currentTimestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Current system time (ISO 8601)."
    },
    "masteryState": {
      "type": "object",
      "description": "Current mastery levels for relevant concepts.",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "conceptId": {
            "type": "string"
          },
          "probabilityCorrect": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "stability": {
            "type": "number",
            "description": "Estimated days until forgetting."
          },
          "lastInteraction": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "probabilityCorrect",
          "confidence"
        ]
      }
    },
    "engagementState": {
      "type": "object",
      "properties": {
        "currentSessionDurationMinutes": {
          "type": "integer"
        },
        "cognitiveLoadIndex": {
          "type": "number",
          "minimum": 0,
          "maximum": 10
        },
        "fatigueLevel": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "isDistracted": {
          "type": "boolean"
        }
      },
      "required": [
        "cognitiveLoadIndex",
        "fatigueLevel"
      ]
    },
    "recentPerformance": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "actionId": {
            "type": "string"
          },
          "outcome": {
            "type": "string",
            "enum": [
              "correct",
              "incorrect",
              "partial"
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    },
    "constraints": {
      "type": "object",
      "properties": {
        "maxSessionTimeMinutes": {
          "type": "integer"
        },
        "availableEnergy": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "detectedPatterns": {
      "type": "array",
      "description": "List of behavioral patterns detected by the upstream analysis agent.",
      "items": {
        "type": "object",
        "properties": {
          "patternId": {
            "type": "string",
            "description": "ID of the pattern (e.g., 'BP01')."
          },
          "patternName": {
            "type": "string"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "lastDetected": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "patternId",
          "confidence"
        ]
      }
    }
  }
}